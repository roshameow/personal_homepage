---
layout: post
title: 组合交易 (一)
categories:
  - finance
tags:
  - content
  - alpha
  - L1_norm
  - simulation
  - combo
  - equal_weight
last_modified_at: 2025-12-24T16:48
created: 2025-05-26T19:24
---
## 单个alpha仿真交易流程

- 输入为  `Matrix`(T x I ), 按照时间顺序交易
- [仿真交易规则](https://platform.worldquantbrain.com/learn/documentation/create-alphas/how-brain-platform-works): 
	- 每天用恒定的账面规模(`book size`)交易,
		- book size 为$20 million. 有$10 million现金, 投资上限为$20million.
	- alpha apply到每只股票上得到alpha value
	-  **L1 归一化**,  得到每只股票的`weight` 
		- 不同neutralize组的booksize是分别计算的? 比如有两个sector, 每个sector scale到 0.5/abs(sector_sum)?
	- 每天在每只股票上投资 `weight*booksize` 
	- 计算`PnL` 


## 组合(combo)

先选择一个alpha pool $\alpha_n$ (N x T x I) 一个权重 $w_n$ (N x T). 按照权重线性组合alpha $\tilde\alpha$ ( T x I ) , 按照$\tilde\alpha$ 交易. $\tilde\alpha=\sum_n w_n\alpha_n$ . 展开写为

$$\tilde\alpha_{ti}=\frac{\sum_n w_{nt}\alpha_{nti}}{\sum_i\vert\sum_n w_{nt}\alpha_{nti}\vert}\quad ,\sum_n w_{nt}=1$$


记每个instrument的当天return $r_{ti}$ . 每个alpha的当天return $R_{nt}=\frac{\sum_i \alpha_{nti}r_{ti}}{\sum_i \vert \alpha_{nti}\vert}$ , 当天组合alpha的实际return $R_t = \sum_i \tilde\alpha_{ti}r_{ti}$ 

### Equal Weight 的定义与优势

当我们取**equal weight**时, 组合 $\tilde \alpha$ 退化成 

$$\tilde\alpha_{ti}=\frac{\sum_n \alpha_{nti}}{\sum_i\vert\sum_n \alpha_{nti}\vert}$$ 


这种简单的平均权重组合在实务中表现出非常强的鲁棒性和实用性，具体原因包括：

* **共识信号增强**：多个 alpha 对某些 instrument 给出同向信号时，该方向上的权重被加强，更有可能体现真正的市场信息。
* **波动抑制**：对同一个 instrument，允许做空的情况下, 不同 alpha 的信号$\alpha_{nti}$ 可能方向相反，合并后会互相抵消, 甚至变成0，降低组合在这些标的上的持仓强度：

  $$
  对某些i,\quad\left| \tilde\alpha_{ti} \right| < \min_n \frac{|\alpha_{nti}|}{\sum_i |\alpha_{nti}|}.
  $$

  从而自动避开一些高风险或噪声较大的标的。
* **组合收益优于子因子**：在允许做多做空的情况下，equal weight 组合往往能取得比所有子 alpha 都更高的收益。这是因为它在分散风险的同时保留了共识部分的 alpha。

---

#### 做多限制下的局限与扩展

当我们只允许做多（即 $\alpha_{nti} \ge 0$）时，equal weight 组合的收益只能处于各子 alpha 收益之间，无法超越它们。这是因为组合是一个凸组合，不具备“负相关对冲”的好处。(简化的考虑, 对于正数abcd, 有 $\min\lbrace\frac{a}{c},\frac{b}{d}\rbrace\le\frac{a+b}{c+d}\le \max\lbrace\frac{a}{c},\frac{b}{d}\rbrace$ )

不过，因为我们允许使用 **负权重组合 alpha**，即允许某些 $w_{nt} < 0$，我们可以构造 **long-short 的 alpha 组合**，进一步提升组合收益和稳健性. 
