---
layout: post
title: 组合交易 (二)
categories:
  - finance
tags:
  - content
last_modified_at: 2026-01-18T19:11
created: 2025-12-24T16:48
---
## 单个alpha的性能


| 维度                        | 指标名称                                  | 描述                                                                                                                                                                               | 计算公式                                                                                                                                                                                                                                     | 特点                     |
| :------------------------ | :------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------- |
| **表现**<br>和未来一天returns的关系 | daily pnl                             |                                                                                                                                                                                  | $S_t\cdot R_{t+1}$                                                                                                                                                                                                                       | 最直接                    |
|                           | Quintile Long–Short Strategy（五分位多空策略） |                                                                                                                                                                                  | $R_{Q5}-R_{Q1}$                                                                                                                                                                                                                          | 常用投资研究方法               |
|                           | Information Coefficient(IC)           | 计算alpha值和未来一天returns的Pearson相关性                                                                                                                                                  | $$IC_t = \rho(S_t,R_{t+1}) = \frac{\sum_{i=1}^N (S_{i,t} - \bar{S}_t)(R_{i,t+1} - \bar{R}_{t+1})}{\sqrt{\sum_{i=1}^N (S_{i,t} - \bar{S}_t)^2 \sum_{i=1}^N (R_{i,t+1} - \bar{R}_{t+1})^2}}$$                                              | 容易受到极端值影响              |
|                           | Fama-MacBeth Regression               | 计算alpha值对未来returns的beta系数                                                                                                                                                        | Linear Regression Model:<br>$R_{i,t+1} = \lambda_{0,t} + \lambda_{1,t} S_{i,t} + \epsilon_{i,t+1}$<br><br>$$\lambda_{1,t} = \frac{\sum_{i=1}^N (S_{i,t} - \bar{S}_t)(R_{i,t+1} - \bar{R}_{t+1})}{\sum_{i=1}^N (S_{i,t} - \bar{S}_t)^2}$$ | 还可以得出alpha和现有alpha的冗余度 |
|                           | RankIC                                | 计算alpha排名和returns排名的[Spearman相关性](https://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient) <br>(是Pearson相关系数的rank版, <br>完全等价, 计算简单) [1](#1-rankic-spearman-公式推导) | $RankIC_t = \rho(\text{rank}(S_t), \text{rank}(R_{t+h}))$<br>$= 1 - \frac{6 \sum d_i^2}{N(N^2 - 1)}$                                                                                                                                     | alpha不受单调非线性变换的影响, 更稳定 |
|                           | Predictive Power Score（PPS）           | IC和RankIC的线性组合                                                                                                                                                                   | $PPS = w_1 \cdot IC + w_2 \cdot RankIC$                                                                                                                                                                                                  |                        |
| **费率**<br>自身时序上的关系        | turnover                              | 衡量 alpha 信号在前后两个交易日的持仓变化程度                                                                                                                                                       | $$\text{Turnover}_t = \frac{\sum_i \vert S_{t,i} - S_{t-1,i} \vert}{2}$$                                                                                                                                                                 |                        |
|                           | Signal Autocorrelation                | Alpha 前后两天的自相关性                                                                                                                                                                  | $AutoCorr = \rho(S_t, S_{t-1})$                                                                                                                                                                                                          |                        |
|                           | Relative Rank Entropy（RRE）            | 用 KL散度 计算前后两天alpha分布的差异                                                                                                                                                          | $D_{KL}(P_t \parallel P_{t-1}) = \sum P_t(i) \ln \frac{P_t(i)}{P_{t-1}(i)}$                                                                                                                                                              |                        |
| **稳定性**<br><br>           | Perturbation Fidelity Score（PFS）      | 加入轻微扰动后信号的相关性<br>- 加入guassian noise<br>- 加入 t 分布                                                                                                                                 | $PFS = \rho(S, S + \epsilon), \epsilon \sim N(0, \sigma^2)$                                                                                                                                                                              |                        |
| **金融逻辑**                  | llm打分                                 | - 是否符合经济直觉<br>- 是否可解释<br>- 是否有金融含义                                                                                                                                               | $\text{Score} = \text{LLM}(Prompt, \text{AlphaLogic})$                                                                                                                                                                                   |                        |

### 1: RankIC (Spearman) 公式推导

Spearman相关系数本质上是**秩(Rank)变量之间的Pearson相关系数**。

对于 $N$ 个样本，alpha排名和returns排名 $x_i, y_i$ 均为 $1, 2, ..., N$ 的排列。
已知前 $N$ 个整数的性质:
1.  **均值**: $\bar{x} = \bar{y} = \frac{N+1}{2}$
2.  **方差项**: $\sum (x_i - \bar{x})^2 = \frac{N(N^2 - 1)}{12}$

定义秩差 $d_i = x_i - y_i$，则:
$$ \sum d_i^2 = \sum (x_i - y_i)^2 = \sum x_i^2 + \sum y_i^2 - 2\sum x_i y_i $$
由于 $\sum x_i^2 = \sum y_i^2$ (都是 $1^2 + ... + N^2$)，代入得:
$$ \sum x_i y_i = \sum x_i^2 - \frac{1}{2} \sum d_i^2 $$

代入 Pearson 相关系数公式:
$$ 
\begin{aligned}
\rho &= \frac{\sum (x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum (x_i - \bar{x})^2 \sum (y_i - \bar{y})^2}} \\
&= \frac{\sum x_i y_i - N\bar{x}\bar{y}}{\sum (x_i - \bar{x})^2} \quad (\text{分母两项相等}) \\
&= \frac{(\sum x_i^2 - \frac{1}{2}\sum d_i^2) - N\bar{x}^2}{\sum x_i^2 - N\bar{x}^2} \\
&= 1 - \frac{\frac{1}{2}\sum d_i^2}{\frac{N(N^2-1)}{12}} \\
&= 1 - \frac{6 \sum d_i^2}{N(N^2 - 1)}
\end{aligned}
$$



## 组合alpha的性能


| 维度                             | 指标名称                   | 描述                                                                                                                                                                                                                                                                              | 计算公式                                                                                                                                                          | 特点                                                       |
| :----------------------------- | :--------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------- |
| 多样性<br><br>不考虑组合方式             | Diversity Entropy (DE) | 衡量 Alpha 集合的非线性相关性与冗余度                                                                                                                                                                                                                                                          | 对 $\Sigma$ 进行特征分解，得到特征值 $\lambda_1, \lambda_2, \dots, \lambda_m$。<br><br>$DE = -\frac{\sum p_i \ln p_i}{\ln m}, \quad p_i = \frac{\lambda_i}{\sum \lambda_j}$ | 量化得出系统的冗余度                                               |
| 平衡性<br><br>只考虑每个instrument线性组合 | Risk Contribution(RC)  | 衡量总风险($\sigma$) 变化时对每个alpha 增量均匀(风险贡献不均衡度) [2](#2-风险分解)<br><br>由[欧拉定理](https://en.wikipedia.org/wiki/Homogeneous_function#Euler's_theorem) , 分解为风险贡献 (Risk Contribution, RC):<br>$\sigma =w_i\frac{\partial \sigma}{\partial w_i}=\Sigma_i \frac{w_i(\Sigma w)_i}{\sigma}=RC_i$ | Risk Parity (风险平价)<br><br><br><br>$\min_{w_i} \sum_{i=1}^N (RC_i - \frac{\sigma}{N})^2$                                                                       | 变量无主次, 分解变简单<br><br>适合用cyclic coordinate descend优化$w_i$  |

### 2. 风险分解

用协方差矩阵 $\Sigma$  衡量样本的组合相关性


$$\frac{\partial \sigma}{\partial w_i}=\frac{\partial}{\partial w_i}( \sqrt{w^T\Sigma w}) \overset{\text{幂函数求导}}{=} \frac{1}{2\sqrt{w^T\Sigma w}} \cdot \frac{\partial (w^T\Sigma w)}{\partial w_i} = \frac{1}{2\sigma} \cdot 2(\Sigma w)_i = \frac{(\Sigma w)_i}{\sigma}$$

其中关于 $w^T\Sigma w$ 的求导细节展开如下:
$$ 
\begin{aligned}
\frac{\partial (w^T\Sigma w)}{\partial w_i} &= \frac{\partial}{\partial w_i} \left(\sum_j \sum_k w_j \Sigma_{jk} w_k\right) \\
&= \frac{\partial}{\partial w_i} \left( w_i \Sigma_{ii} w_i + \sum_{k \neq i} w_i \Sigma_{ik} w_k + \sum_{j \neq i} w_j \Sigma_{ji} w_i + \sum_{j \neq i, k \neq i} w_j \Sigma_{jk} w_k \right) \\
&= 2w_i \Sigma_{ii} + \sum_{k \neq i} \Sigma_{ik} w_k + \sum_{j \neq i} w_j \Sigma_{ji} \\
&= \sum_{k} \Sigma_{ik} w_k + \sum_{j} w_j \Sigma_{ji} \\
&= (\Sigma w)_i + (\Sigma^T w)_i \\
&= 2(\Sigma w)_i \quad (\text{因协方差矩阵对称 } \Sigma = \Sigma^T)
\end{aligned}
$$

